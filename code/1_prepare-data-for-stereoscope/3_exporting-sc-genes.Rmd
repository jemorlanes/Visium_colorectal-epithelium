---
title: "exporting_HV_curated_variableGenes"
author: "Javier Escudero"
date: "2023-07-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Libraries
```{r}
rm(list=ls())

library(readxl)
library(tidyverse)
```

# Summary
The goal is to export the manually curated list of genes provided in the Excel *Figure 1 - top 20 genes with annotation*. The counts and annotations of the single cells has already been prepped.

Thus, here I will just keep the variable genes for the celltypes that I grabbed previously. 

# Analysis
Loading the selected celltypes
```{r}
stsc.celltypes <- read_tsv("your path/HV_mta_data.tsv") %>%
  pull(celltype) %>% unique()
```

Loading the data from the excel.
```{r}
excel.data <- read_excel(list.files("your path to the location of the excel path with the marker genes",
                                 full.names = TRUE, pattern = ".xlsx"))
```

We didn't select all the celltypes, so let's just keep genes for the celltypes we have. This is due to the downsampling done previously.
```{r}
# getting genes and cluster (celltype)
gene.df <- select(excel.data, c(gene, cluster)) %>%
  mutate(cluster = as.character(cluster))
celltype.cluster <- as.data.frame(t(excel.data[21, c(9:37)])) %>%
  rownames_to_column(var = "cluster") %>%
  mutate(cluster = as.character(cluster)) %>%
  rename(celltype = V1) 

# keeping genes for celltypes that we want
gene.df <- inner_join(gene.df, celltype.cluster , by = "cluster")
```

We need to do some small adjustments to the formats of the names of the celltypes.
```{r}
# removing white spaces from everything
stsc.celltypes <- gsub(" ","", stsc.celltypes)
gene.df$celltype <- gsub(" ", "", gene.df$celltype)

stsc.celltypes <- gsub("[[:punct:]][[:upper:]][[:punct:]]", "", stsc.celltypes)
```

Getting the genes
```{r}
variable.genes <- filter(gene.df, celltype %in% stsc.celltypes) %>%
  pull(gene)
```

Exporting
```{r}
write_lines(variable.genes, 
          file = "your path/HV_curated_variableGenes.txt")
```

# Metadata
```{r}
date()
sessionInfo()
```








